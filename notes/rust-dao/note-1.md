# 《Rust 编程之道》Note

## 第一章 新时代的语言

从全局的角度概括 Rust 的设计哲学，心智模型。

Rust: 侧重性能、安全、并发

- 内存安全：类型系统、所有权系统、借用和生命周期
- 零成本抽象：泛型、trait
- 实用性：错误处理 (失败、错误和异常)，包管理 cargo

语言架构：

1. 混合范式编程：面向对象，函数式
2. 语义：所有权，move，copy，借用，生命周期，drop
3. 类型系统：泛型，trait，一切皆类型，多态，类型推断
4. 安全内存管理：栈，RAII，堆

开发者掌握 1/2/3 就行，4 是编译器的范畴。

学习 Rust：

- 保持初学者心态 (zan!)
- 先学习概念再动手实践
- 把编译器当朋友

## 第二章 语言精要

从全局的角度概括 Rust 的主要语法。后面还会分章节详述。先让读者对 Rust 有一个大概认识。

### 2.1 Rust 语言的基本构成

- 语言规范
- 编译器
- 核心库: primitive，包括 trait, 原始类型，常见功能型数据结构，宏定义。不包括 os/network/heap/concurrent/io
- 标准库: std，包括核心库所有，另外还有并发，IO，运行时；平台抽象；底层操作接口，错误处理等
- 包管理器: cargo

### 2.2 语句与表达式

单元类型 unit ()，默认返回值。

rust 中有分号和没分号意义是不一样的。

### 2.3 变量与绑定

略

### 2.4 函数与闭包

定义 fn

作用域和生命周期

函数指针：函数为一等公民，可以作为函数参数和返回值

const fn: 常量函数，编译期执行的函数

闭包：匿名函数。闭包可以捕捉外部变量，函数不可以。

### 2.5 流程控制

- if...else
- while, loop, for...in (只有这三种，for 只有 for...in 这一种用法)
- match, if let, while let

### 2.6 基本数据类型

- bool
- 数值
- 字符 char
- 数组 `[T; n]`
- Range 1..5 1..=5
- slice `&[T]` `&mut[T]`
- str / String
- 原生指针：`*const T`, `*mut T`
- never 类型：!

### 2.7 复合类型

Tuple / Struct / Enum

携带参数的枚举类型本质上属于函数指针

```rust
enum IpAddr {
  V4(u8, u8, u8, u8),
  V6(String),
}
fn main() {
  let x: fn(u8,u8,u8,u8) -> IpAddr = IpAddr::V4;
  let y: fn(String) -> IpAddr = IpAddr::V6;
  let home = IpAddr::V4(127,0,0,0);
}
```

### 2.8 常用集合类型

std::collections，先记住一个 Vec 就行，其它用到再看

### 2.9 智能指针

Rust 中的值默认被分配到栈内存，可以通过 `Box<T>` 将值装箱，分配到堆上。

### 2.10 泛型和 trait

trait 是对类型行为的抽象。类似其它语言的 interface，但不同的是，其它语言的 interface 可以用来表示类型，但 rust 不行。

- 静态分发，零成本抽象，类似 c++ 的模版，编译期生成
- 动态分发，类似多态，运行期查找对应对象的方法并执行

### 2.11 错误处理

使用 `Result<T, E>` 进行处理。

### 2.12 表达式优先级

略

### 2.13 注释与打印

略，在《深入浅出 rust》笔记中有详述。
